pipeline {
  agent any
  environment { VENV = 'venv' }
  options { timestamps(); ansiColor('xterm'); disableConcurrentBuilds() }
  stages {
    stage('Checkout') { steps { checkout scm } }
    stage('Setup Python') {
      steps {
        sh '''
          python3 -m venv ${VENV}
          . ${VENV}/bin/activate
          python -m pip install -U pip
          pip install -r requirements.txt || true
          pip install pytest ruff
        '''
      }
    }
    stage('Lint') {
      steps { sh '. ${VENV}/bin/activate && ruff check Agentic-Coding-Pipeline || true' }
    }
    stage('Tests') {
      steps { sh '. ${VENV}/bin/activate && pytest -q Agentic-Coding-Pipeline/tests' }
    }
  }
}

